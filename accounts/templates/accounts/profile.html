{% extends "accounts/profile_base.html" %} {% load static %} {% block title %}
{{ profile_user.username }}'s Profile Page{% endblock %} {% block content %}

<!-- Left panel with Profile info -->
<div class="profile-sidepanel">
  <div class="profile-box">
    <!-- NEED TO IMPORT FROM SETTIGNS -->
    <img src="media-4.jpg" alt="media-2.jpg" class="profile-pic" />
    <h2 class="profile-name">{{ profile_user.username }}</h2>

    <!-- NEED TO IMPORT FROM SETTIGNS -->
    <!-- <p class="profile-bio">Actress â€¢ Simger</p> -->

    <div class="profile-details">
      <div><strong>{{ user_posts.count }}</strong><span> Posts</span></div>
    </div>

    <button class="edit-button">Edit Profile</button>
  </div>
</div>

<!-- Right panel with posts and Notification -->
<section class="profile-content">
  <div class="profile-tabs">
    <button class="tab active" onclick="showTab('posts')">Posts</button>

    <button
      class="tab notification-tab {% if has_new_notifications %}unread{% endif %}"
      onclick="handleNotificationClick(event)"
    >
      Notifications
    </button>
  </div>

  <!-- Posts list -->
  <div class="tab-content active" id="posts">
    {% for post in user_posts %}
    <div class="post-box">
      <strong>{{ post.title }}</strong>
      <p>{{ post.description }}</p>
      <small
        >Posted on: {{ post.date_time|date:"Y-m-d H:i" }} from {{post.location}}
        with tag {{ post.get_tag_display }}
      </small>
    </div>
    {% empty %}
    <div class="post-box">You haven't made any posts yet!</div>
    {% endfor %}
  </div>

  <!-- Notifications list -->
  <div class="tab-content" id="notifications" style="display: none">
    {% for notification in user_notifications %}
    <div class="post-box">
      <p>{{ notification.message }}</p>
      <small>{{ notification.created_at|date:"M d, Y H:i" }}</small>
    </div>
    {% empty %}
    <div class="post-box">No Notifications</div>
    {% endfor %}
  </div>
</section>

<script>
  function handleNotificationClick(event) {
    const tabName = "notifications";

    showTab(tabName);

    const readUrl = "{% url 'posts:mark_notifications_read' %}";

    fetch(readUrl)
      .then((response) => {
        if (response.ok) {
          const tabButton = event.target.closest(".notification-tab");
          tabButton.classList.remove("unread");
        }
      })
      .catch((error) =>
        console.error("Error marking notifications as read:", error)
      );
  }

  function showTab(tabName) {
    var contents = document.querySelectorAll(".tab-content");
    for (var i = 0; i < contents.length; i++) {
      contents[i].style.display = "none";
      contents[i].classList.remove("active");
    }

    var tabs = document.querySelectorAll(".tab");
    for (var i = 0; i < tabs.length; i++) {
      tabs[i].classList.remove("active");
    }

    document.getElementById(tabName).style.display = "block";
    document.getElementById(tabName).classList.add("active");

    if (event && event.currentTarget) {
      event.currentTarget.classList.add("active");
    }
  }
</script>
{% endblock content %}
