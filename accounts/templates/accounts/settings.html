{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="{% static 'css/settings.css' %}" />

    <title>Settings</title>
  </head>
  <body>
    <header class="header-container">
      <h1 class="app-name">Unfiltered</h1>
      <nav>
        <a class="link" href="{% url 'posts:home' %}">Home</a>
        <a href="{% url 'accounts:profile' %}">Profile</a>
        <a class="link" href="{% url 'accounts:logout' %}">Log Out</a>
      </nav>
    </header>

    {% if messages %} {% for message in messages|slice:":1" %}
    <div class="messages">
      <div class="alert {{ message.tags }}">{{ message }}</div>
    </div>
    {% endfor %} {% endif %}

    <main class="settings-layout">
      <!-- Left panel -->
      <div class="settings-sidepanel">
        <div class="settings-box">
          <button onclick="showTab(this, 'profile')">Profile</button>
          <button onclick="showTab(this, 'account')">Account</button>
          <button onclick="showTab(this, 'security')">Security</button>

          <button onclick="showTab(this, 'logout')">Logout</button>
        </div>
      </div>

      <!-- Right panel -->
      <div class="settings-content">
        <!-- Profile -->
        <section id="profile" class="settings-section active">
          <h2>Profile Settings</h2>
          <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" name="which" value="profile" />
            <p><label>Display name:</label> {{ pform.display_name }}</p>
            <p><label>Bio:</label> {{ pform.bio }}</p>
            <p><label>Avatar:</label> {{ pform.avatar }}</p>
            <button type="submit">Save Changes</button>
          </form>
        </section>

        <!-- Account -->
        <section id="account" class="settings-section">
          <h2>Account Settings</h2>
          <form method="post">
            {% csrf_token %}
            <input type="hidden" name="which" value="account" />
            <p><label>Change Username:</label> {{ uform.username }}</p>

            <button type="submit">Save Changes</button>
          </form>
        </section>

        <!-- Security -->
        <section id="security" class="settings-section">
          <h2>Security Settings</h2>
          <form method="post">
            {% csrf_token %}
            <input type="hidden" name="which" value="password" />
            {{ pwform.as_p }}
            <button type="submit">Change Password</button>
          </form>
        </section>

        <!-- Logout -->
        <section id="logout" class="settings-section">
          <h2>Logout</h2>
          <form action="{% url 'accounts:logout' %}" method="post">
            {% csrf_token %}
            <button type="submit">Log Out</button>
          </form>
        </section>
      </div>
    </main>

    <script>
      setTimeout(() => {
        document.querySelectorAll(".alert").forEach((el) => {
          el.style.transition = "opacity 0.6s ease";
          el.style.opacity = "0";
          setTimeout(() => el.remove(), 600); // Remove after fade
        });
      }, 3000);

      function showTab(button, tabId) {
        document
          .querySelectorAll(".settings-section")
          .forEach((sec) => sec.classList.remove("active"));
        document.getElementById(tabId).classList.add("active");
        document
          .querySelectorAll(".settings-box button")
          .forEach((b) => b.classList.remove("active"));
        button.classList.add("active");
      }
    </script>
  </body>
</html>
